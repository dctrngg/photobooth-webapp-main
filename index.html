<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>dctrng's Booth</title>

  <link rel="icon" href="Assets/fish-photobooth/favicon.png" type="image/x-icon" />
  <link rel="stylesheet" href="StyleSheets/home.css" />

  <style>
    /* ================= Overlay Photobooth ================= */
    #photobooth-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100vw; height: 100vh;
      z-index: 9999;
      background: #000;
      opacity: 1;
      transition: opacity 0.6s ease;
      overflow: hidden;
    }

    #photobooth-iframe {
      width: 100%; height: 100%;
      border: none;
      overflow: auto;
      -webkit-overflow-scrolling: touch;
    }

    /* N·ªôi dung ch√≠nh ·∫©n ban ƒë·∫ßu */
    .home-container {
      opacity: 0;
      transition: opacity 0.6s ease;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .home-container.visible {
      opacity: 1;
    }

    body {
      overflow: hidden;
    }
  </style>
</head>

<body>
  <!-- ================= Overlay Photobooth ================= -->
  <div id="photobooth-overlay">
    <iframe id="photobooth-iframe" src="./dist/index.html" scrolling="yes"></iframe>
  </div>

  <!-- Main Container -->
  <div class="home-container" id="main-content">
    <div class="photobooth-container">
      <div class="photobooth-mock"></div>
      <div class="photostrip-mock"></div>
      <div class="bubbles-mock"></div>
      <div class="fish-mock-1"></div>
      <div class="fish-mock-2"></div>
      <div class="fish-mock-3"></div>
    </div>

    <div class="button-container">
      <button id="select-button">Select</button>
    </div>
  </div>

  <!-- Tutorial Modal -->
  <div class="tutorial-modal" id="tutorialModal">
    <div class="modal-content">
      <button class="close-modal" id="closeModal" aria-label="ƒê√≥ng">√ó</button>
      <div class="modal-header">
        <h2>H∆∞·ªõng D·∫´n S·ª≠ D·ª•ng</h2>
      </div>
      <div class="modal-body">
        <div class="tutorial-step">
          <strong>üì∏ B∆∞·ªõc 1: Ch·ªçn Ch·∫ø ƒê·ªô</strong>
          <span>Ch·ªçn Camera ƒë·ªÉ ch·ª•p ·∫£nh tr·ª±c ti·∫øp ho·∫∑c Upload ƒë·ªÉ t·∫£i ·∫£nh c√≥ s·∫µn</span>
        </div>
        <div class="tutorial-step">
          <strong>üé® B∆∞·ªõc 2: T·∫°o Photo Strip</strong>
          <span>Ch·ª•p 2 ·∫£nh ho·∫∑c upload 2 ·∫£nh ƒë·ªÉ t·∫°o photo strip c·ªßa b·∫°n</span>
        </div>
        <div class="tutorial-step">
          <strong>‚ú® B∆∞·ªõc 3: Trang Tr√≠</strong>
          <span>Th√™m sticker, ƒëi·ªÅu ch·ªânh k√≠ch th∆∞·ªõc v√† xoay ƒë·ªÉ trang tr√≠ ·∫£nh</span>
        </div>
        <div class="tutorial-step">
          <strong>üíæ B∆∞·ªõc 4: Chia S·∫ª</strong>
          <span>T·∫£i xu·ªëng ho·∫∑c t·∫°o QR code ƒë·ªÉ chia s·∫ª v·ªõi b·∫°n b√®</span>
        </div>
      </div>
      <div class="modal-buttons">
        <button class="modal-btn btn-start" id="startBtn">B·∫Øt ƒê·∫ßu</button>
        <button class="modal-btn btn-skip" id="skipBtn">B·ªè Qua</button>
      </div>
    </div>
  </div>

  <!-- Main JS -->
  <script src="Javascripts/home.js"></script>

  <!-- ================= Iframe ‚Üí Home Scroll Control ================= -->
  <script>
    window.addEventListener("message", (event) => {
      if (event.data.action === "finished-scroll") {
        const overlay = document.getElementById("photobooth-overlay");
        const mainContent = document.getElementById("main-content");

        // 1. ·∫®n iframe m∆∞·ª£t m√†
        overlay.style.opacity = "0";
        setTimeout(() => {
          overlay.style.display = "none";
          document.body.style.overflow = "auto";
        }, 600);

        // 2. Hi·ªán trang ch√≠nh
        mainContent.classList.add("visible");

        // 3. T·ª∞ ƒê·ªòNG SCROLL XU·ªêNG home-container
        setTimeout(() => {
          mainContent.scrollIntoView({
            behavior: "smooth",
            block: "center"
          });
        }, 700);
      }
    });
  </script>

  <!-- ================= Modal & Buttons JS ================= -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const modal = document.getElementById('tutorialModal');
      const selectButton = document.getElementById('select-button');
      const startBtn = document.getElementById('startBtn');
      const skipBtn = document.getElementById('skipBtn');
      const closeModalBtn = document.getElementById('closeModal');

      if (selectButton) {
        const newSelectButton = selectButton.cloneNode(true);
        selectButton.parentNode.replaceChild(newSelectButton, selectButton);

        newSelectButton.addEventListener('click', function (e) {
          e.preventDefault();
          e.stopPropagation();
          if (modal) {
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
          }
        }, true);
      }

      function goToMenu() {
        window.location.href = 'menu.html';
      }

      function closeModal() {
        modal.classList.remove('show');
        document.body.style.overflow = '';
      }

      if (startBtn) startBtn.addEventListener('click', goToMenu);
      if (skipBtn) skipBtn.addEventListener('click', goToMenu);
      if (closeModalBtn) closeModalBtn.addEventListener('click', closeModal);

      if (modal) {
        modal.addEventListener('click', function (e) {
          if (e.target === modal) closeModal();
        });
      }

      document.addEventListener('keydown', function (e) {
        if (e.key === 'Escape' && modal && modal.classList.contains('show')) closeModal();
      });

      let lastTouchEnd = 0;
      document.addEventListener('touchend', function (e) {
        const now = Date.now();
        if (now - lastTouchEnd <= 300) e.preventDefault();
        lastTouchEnd = now;
      }, false);
    });
  </script>
</body>

</html>